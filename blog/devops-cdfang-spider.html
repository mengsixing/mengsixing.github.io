<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实战：手搭一个 React，Typescript，Koa，GraphQL 环境 | 前端日志</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/hero.jpeg">
    <meta name="description" content="欢迎访问公众号：前端日志">
    
    <link rel="preload" href="/assets/css/0.styles.4e5fc4ef.css" as="style"><link rel="preload" href="/assets/js/app.743a7fff.js" as="script"><link rel="preload" href="/assets/js/2.807b3b4f.js" as="script"><link rel="preload" href="/assets/js/38.7fd498f0.js" as="script"><link rel="preload" href="/assets/js/3.f6a35f03.js" as="script"><link rel="prefetch" href="/assets/js/10.3ce4ed6e.js"><link rel="prefetch" href="/assets/js/100.213d1d14.js"><link rel="prefetch" href="/assets/js/101.a41a0b55.js"><link rel="prefetch" href="/assets/js/102.a4210065.js"><link rel="prefetch" href="/assets/js/103.63746763.js"><link rel="prefetch" href="/assets/js/104.5180f1a2.js"><link rel="prefetch" href="/assets/js/105.e9ccba0c.js"><link rel="prefetch" href="/assets/js/106.864b16b3.js"><link rel="prefetch" href="/assets/js/107.191e5c58.js"><link rel="prefetch" href="/assets/js/108.a08fb010.js"><link rel="prefetch" href="/assets/js/109.e7bae42d.js"><link rel="prefetch" href="/assets/js/11.3aca9ec0.js"><link rel="prefetch" href="/assets/js/110.87a26308.js"><link rel="prefetch" href="/assets/js/111.174e490d.js"><link rel="prefetch" href="/assets/js/112.83015292.js"><link rel="prefetch" href="/assets/js/113.82706b03.js"><link rel="prefetch" href="/assets/js/114.0629fe1e.js"><link rel="prefetch" href="/assets/js/115.3d0887ab.js"><link rel="prefetch" href="/assets/js/116.4362fc5b.js"><link rel="prefetch" href="/assets/js/117.12bf8f78.js"><link rel="prefetch" href="/assets/js/118.ef5c23c8.js"><link rel="prefetch" href="/assets/js/119.41047450.js"><link rel="prefetch" href="/assets/js/12.80544f1e.js"><link rel="prefetch" href="/assets/js/120.9639ed39.js"><link rel="prefetch" href="/assets/js/121.23e8582d.js"><link rel="prefetch" href="/assets/js/122.0ad86029.js"><link rel="prefetch" href="/assets/js/123.48fb42fe.js"><link rel="prefetch" href="/assets/js/124.a50fd7c7.js"><link rel="prefetch" href="/assets/js/125.1a2bebb5.js"><link rel="prefetch" href="/assets/js/126.68a80065.js"><link rel="prefetch" href="/assets/js/127.9ca54b62.js"><link rel="prefetch" href="/assets/js/128.545449c5.js"><link rel="prefetch" href="/assets/js/129.d9a5268d.js"><link rel="prefetch" href="/assets/js/13.963c5e13.js"><link rel="prefetch" href="/assets/js/130.819bdc49.js"><link rel="prefetch" href="/assets/js/131.6308fa0b.js"><link rel="prefetch" href="/assets/js/14.f8e99d15.js"><link rel="prefetch" href="/assets/js/15.f1ebdfcf.js"><link rel="prefetch" href="/assets/js/16.cb3d7efe.js"><link rel="prefetch" href="/assets/js/17.36815632.js"><link rel="prefetch" href="/assets/js/18.a60591da.js"><link rel="prefetch" href="/assets/js/19.632fbba3.js"><link rel="prefetch" href="/assets/js/20.d376a645.js"><link rel="prefetch" href="/assets/js/21.f1fe6bb2.js"><link rel="prefetch" href="/assets/js/22.f838ba2f.js"><link rel="prefetch" href="/assets/js/23.8787d59d.js"><link rel="prefetch" href="/assets/js/24.bd0fe6bf.js"><link rel="prefetch" href="/assets/js/25.0f1530ce.js"><link rel="prefetch" href="/assets/js/26.0b6460e3.js"><link rel="prefetch" href="/assets/js/27.435fbc3a.js"><link rel="prefetch" href="/assets/js/28.4bde2a9e.js"><link rel="prefetch" href="/assets/js/29.ba709676.js"><link rel="prefetch" href="/assets/js/30.59719103.js"><link rel="prefetch" href="/assets/js/31.7581938d.js"><link rel="prefetch" href="/assets/js/32.853c2fde.js"><link rel="prefetch" href="/assets/js/33.82f02556.js"><link rel="prefetch" href="/assets/js/34.a5aacc11.js"><link rel="prefetch" href="/assets/js/35.d1aae6ec.js"><link rel="prefetch" href="/assets/js/36.3430d872.js"><link rel="prefetch" href="/assets/js/37.dafd9f60.js"><link rel="prefetch" href="/assets/js/39.cff1216d.js"><link rel="prefetch" href="/assets/js/4.a272648d.js"><link rel="prefetch" href="/assets/js/40.5d8259f1.js"><link rel="prefetch" href="/assets/js/41.8e386310.js"><link rel="prefetch" href="/assets/js/42.e5128a2c.js"><link rel="prefetch" href="/assets/js/43.0b50a9e5.js"><link rel="prefetch" href="/assets/js/44.d66d0aee.js"><link rel="prefetch" href="/assets/js/45.cc18cecd.js"><link rel="prefetch" href="/assets/js/46.999d0bea.js"><link rel="prefetch" href="/assets/js/47.e3ccb9c2.js"><link rel="prefetch" href="/assets/js/48.53b89b74.js"><link rel="prefetch" href="/assets/js/49.40e10f1b.js"><link rel="prefetch" href="/assets/js/5.4daa9c3b.js"><link rel="prefetch" href="/assets/js/50.46d02a5c.js"><link rel="prefetch" href="/assets/js/51.1fd958cd.js"><link rel="prefetch" href="/assets/js/52.d41d142f.js"><link rel="prefetch" href="/assets/js/53.033f7145.js"><link rel="prefetch" href="/assets/js/54.fb0ea94a.js"><link rel="prefetch" href="/assets/js/55.45e24001.js"><link rel="prefetch" href="/assets/js/56.2f76ad70.js"><link rel="prefetch" href="/assets/js/57.3acffc44.js"><link rel="prefetch" href="/assets/js/58.3ca1f3cc.js"><link rel="prefetch" href="/assets/js/59.5efb25ac.js"><link rel="prefetch" href="/assets/js/6.95e5989f.js"><link rel="prefetch" href="/assets/js/60.638b88c2.js"><link rel="prefetch" href="/assets/js/61.aec701bc.js"><link rel="prefetch" href="/assets/js/62.e512974e.js"><link rel="prefetch" href="/assets/js/63.2fa65ba9.js"><link rel="prefetch" href="/assets/js/64.a8a5bed9.js"><link rel="prefetch" href="/assets/js/65.ab52b4cf.js"><link rel="prefetch" href="/assets/js/66.ad32128d.js"><link rel="prefetch" href="/assets/js/67.bb1e2f6f.js"><link rel="prefetch" href="/assets/js/68.3aa288ec.js"><link rel="prefetch" href="/assets/js/69.322946a3.js"><link rel="prefetch" href="/assets/js/7.51086548.js"><link rel="prefetch" href="/assets/js/70.cfcea821.js"><link rel="prefetch" href="/assets/js/71.f324ea96.js"><link rel="prefetch" href="/assets/js/72.ffbd3b38.js"><link rel="prefetch" href="/assets/js/73.a755b1dd.js"><link rel="prefetch" href="/assets/js/74.15b18753.js"><link rel="prefetch" href="/assets/js/75.b541a019.js"><link rel="prefetch" href="/assets/js/76.76a73540.js"><link rel="prefetch" href="/assets/js/77.7fd2819e.js"><link rel="prefetch" href="/assets/js/78.4eae81ab.js"><link rel="prefetch" href="/assets/js/79.3023d267.js"><link rel="prefetch" href="/assets/js/8.1aa70e43.js"><link rel="prefetch" href="/assets/js/80.f930e272.js"><link rel="prefetch" href="/assets/js/81.23507d26.js"><link rel="prefetch" href="/assets/js/82.41ef517f.js"><link rel="prefetch" href="/assets/js/83.2b93fe27.js"><link rel="prefetch" href="/assets/js/84.0c61425f.js"><link rel="prefetch" href="/assets/js/85.afb4e337.js"><link rel="prefetch" href="/assets/js/86.3a8fafcd.js"><link rel="prefetch" href="/assets/js/87.83b33e53.js"><link rel="prefetch" href="/assets/js/88.d8e9d64f.js"><link rel="prefetch" href="/assets/js/89.a2418ff5.js"><link rel="prefetch" href="/assets/js/9.b8b87c30.js"><link rel="prefetch" href="/assets/js/90.91a033ba.js"><link rel="prefetch" href="/assets/js/91.0df0cc2a.js"><link rel="prefetch" href="/assets/js/92.111bb40b.js"><link rel="prefetch" href="/assets/js/93.310e22ad.js"><link rel="prefetch" href="/assets/js/94.d15e101c.js"><link rel="prefetch" href="/assets/js/95.5f5be55b.js"><link rel="prefetch" href="/assets/js/96.2e626ec7.js"><link rel="prefetch" href="/assets/js/97.3cfcd553.js"><link rel="prefetch" href="/assets/js/98.3f7399b0.js"><link rel="prefetch" href="/assets/js/99.caf3e512.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4e5fc4ef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  原创
</a></div><div class="nav-item"><a href="/translate/" class="nav-link">
  翻译
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://mengsixing.github.io/front-end-navigation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端导航
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/mengsixing/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  原创
</a></div><div class="nav-item"><a href="/translate/" class="nav-link">
  翻译
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  面试题
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://mengsixing.github.io/front-end-navigation" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端导航
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/mengsixing/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DevOps</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/devops-microfrontend.html" class="sidebar-link">微前端自检清单</a></li><li><a href="/blog/devops-kubernetes.html" class="sidebar-link">Kubernetes 使用总结</a></li><li><a href="/blog/devops-docker.html" class="sidebar-link">Docker 使用总结</a></li><li><a href="/blog/devops-git.html" class="sidebar-link">Git 常用使用方式</a></li><li><a href="/blog/devops-dependencies.html" class="sidebar-link">Package.json 依赖管理</a></li><li><a href="/blog/devops-image.html" class="sidebar-link">合理选择图片格式</a></li><li><a href="/blog/devops-performance.html" class="sidebar-link">前端性能优化</a></li><li><a href="/blog/devops-commitlint.html" class="sidebar-link">Commitlint 使用总结</a></li><li><a href="/blog/devops-cli-diy.html" class="sidebar-link">实现一个自己的 CLI</a></li><li><a href="/blog/devops-test.html" class="sidebar-link">前端测试</a></li><li><a href="/blog/devops-webpack-entry.html" class="sidebar-link">Webpack 系列（三）整体流程分析</a></li><li><a href="/blog/devops-webpack-flow.html" class="sidebar-link">Webpack 系列（二）手写模块打包代码</a></li><li><a href="/blog/devops-webpack.html" class="sidebar-link">Webpack 系列（一）使用总结</a></li><li><a href="/blog/devops-cdfang-spider.html" aria-current="page" class="active sidebar-link">实战：手搭一个 React，Typescript，Koa，GraphQL 环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#项目选型" class="sidebar-link">项目选型</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#搭建-typescript-环境" class="sidebar-link">搭建 TypeScript 环境</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#搭建-react-环境" class="sidebar-link">搭建 React 环境</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#搭建-nodejs-环境" class="sidebar-link">搭建 NodeJs 环境</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#搭建测试环境" class="sidebar-link">搭建测试环境</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#配置上线环境" class="sidebar-link">配置上线环境</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/devops-cdfang-spider.html#参考链接" class="sidebar-link">参考链接</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/library-node.html" class="sidebar-link">Node.js 使用总结</a></li><li><a href="/blog/library-react.html" class="sidebar-link">React 使用总结</a></li><li><a href="/blog/libary-react-core.html" class="sidebar-link">React 核心知识</a></li><li><a href="/blog/library-react-code-1.html" class="sidebar-link">React 源码解析（一）JSX 转换</a></li><li><a href="/blog/library-react-code-2.html" class="sidebar-link">React 源码解析（二）FiberRoot 构建</a></li><li><a href="/blog/library-react-code-3.html" class="sidebar-link">React 源码解析（三）Fiber 的调度过程</a></li><li><a href="/blog/library-react-code-4.html" class="sidebar-link">React 源码解析（四）深入理解 fiber 更新过程</a></li><li><a href="/blog/library-react-ssr.html" class="sidebar-link">React 服务器端渲染</a></li><li><a href="/blog/library-react-hooks.html" class="sidebar-link">使用 React Hooks 节省 90% 的代码</a></li><li><a href="/blog/library-vue.html" class="sidebar-link">Vue 使用总结</a></li><li><a href="/blog/library-vue-flow.html" class="sidebar-link">图解 Vue 响应式原理</a></li><li><a href="/blog/library-vue-nexttick.html" class="sidebar-link">图解 Vue 异步更新</a></li><li><a href="/blog/library-miniProgram.html" class="sidebar-link">小程序使用总结</a></li><li><a href="/blog/library-redux.html" class="sidebar-link">Redux 使用总结</a></li><li><a href="/blog/library-react-redux-code.html" class="sidebar-link">React Hooks 替代 React-Redux</a></li><li><a href="/blog/library-rxjs.html" class="sidebar-link">RxJS 基础知识总结</a></li><li><a href="/blog/library-koa.html" class="sidebar-link">Koa 源码阅读</a></li><li><a href="/blog/library-koa-diy.html" class="sidebar-link">深入 Koa 原理</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css-icon.html" class="sidebar-link">网站图标开发指南</a></li><li><a href="/blog/css.html" class="sidebar-link">CSS 使用总结</a></li><li><a href="/blog/css-modules.html" class="sidebar-link">CSS 模块化</a></li><li><a href="/blog/css-next.html" class="sidebar-link">CSS NEXT 语法</a></li><li><a href="/blog/css-ifc.html" class="sidebar-link">CSS IFC 总结</a></li><li><a href="/blog/css-flex.html" class="sidebar-link">CSS Flex 布局总结</a></li><li><a href="/blog/css-useful.html" class="sidebar-link">CSS 有趣的特性</a></li><li><a href="/blog/css-devicePixelRatio.html" class="sidebar-link">CSS 设备像素比</a></li><li><a href="/blog/css-houdini-star.html" class="sidebar-link">CSS Houdini 画一片星空</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>网络协议</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/osi-flow.html" class="sidebar-link">一文串联 HTTP、TCP、IP、以太网</a></li><li><a href="/blog/osi-http.html" class="sidebar-link">HTTP 协议总结</a></li><li><a href="/blog/osi-https.html" class="sidebar-link">HTTPS 协议总结</a></li><li><a href="/blog/osi-tcp.html" class="sidebar-link">TCP 协议总结</a></li><li><a href="/blog/osi-web-security.html" class="sidebar-link">一文读懂 Web 安全</a></li><li><a href="/blog/osi-web-login.html" class="sidebar-link">前端登录，这一篇就够了</a></li><li><a href="/blog/osi-hijack.html" class="sidebar-link">流量劫持</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>运维相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/operation-docker-micro-service.html" class="sidebar-link">Docker 部署简单的 Web 服务</a></li><li><a href="/blog/operation-linux.html" class="sidebar-link">Linux 快捷键</a></li><li><a href="/blog/operation-linux-login.html" class="sidebar-link">Linux 免密登录配置</a></li><li><a href="/blog/operation-linux-file.html" class="sidebar-link">Linux 替换文件内容命令</a></li><li><a href="/blog/operation-nginx-match.html" class="sidebar-link">Nginx Location 匹配规则</a></li><li><a href="/blog/operation-nginx-load-balancing.html" class="sidebar-link">Nginx 负载均衡配置</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS 基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js-prototype.html" class="sidebar-link">快速读懂 JS 原型链</a></li><li><a href="/blog/js-principle.html" class="sidebar-link">JS 编译器，解释引擎</a></li><li><a href="/blog/js-promise.html" class="sidebar-link">JS 理解 Promise</a></li><li><a href="/blog/js-this.html" class="sidebar-link">JS 理解 This</a></li><li><a href="/blog/js-canvas.html" class="sidebar-link">两行代码实现图片碎片化加载</a></li><li><a href="/blog/js-operator-priority.html" class="sidebar-link">JS 运算符优先级</a></li><li><a href="/blog/js-jsBridge.html" class="sidebar-link">JS Bridge 总结</a></li><li><a href="/blog/js-module.html" class="sidebar-link">JS 模块化</a></li><li><a href="/blog/js-inherit.html" class="sidebar-link">JS 实现继承</a></li><li><a href="/blog/js-event.html" class="sidebar-link">JS 事件</a></li><li><a href="/blog/js-form.html" class="sidebar-link">JS 表单基础知识</a></li><li><a href="/blog/js-html5-program.html" class="sidebar-link">JS PostMessage &amp; 拖放 API</a></li><li><a href="/blog/js-recursion.html" class="sidebar-link">JS 函数尾递归优化</a></li><li><a href="/blog/js-object-ergodic.html" class="sidebar-link">JS 对象属性的遍历</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/base-function-monad.html" class="sidebar-link">学习函数式编程 Monad</a></li><li><a href="/blog/base-function.html" class="sidebar-link">轻松实战函数式编程</a></li><li><a href="/blog/base-typescript.html" class="sidebar-link">Typescript 使用总结</a></li><li><a href="/blog/base-graphql.html" class="sidebar-link">GraphQL 使用总结</a></li><li><a href="/blog/base-ioc.html" class="sidebar-link">你需要知道的依赖注入</a></li><li><a href="/blog/base-functional.html" class="sidebar-link">函数式编程</a></li><li><a href="/blog/base-webcomponents.html" class="sidebar-link">Web Component 基础</a></li><li><a href="/blog/base-structure.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/blog/base-structure-base-select.html" class="sidebar-link">查找算法</a></li><li><a href="/blog/base-structure-base-sort.html" class="sidebar-link">基本排序算法</a></li><li><a href="/blog/base-structure-high-algorithm.html" class="sidebar-link">高级算法</a></li><li><a href="/blog/base-structure-senior-sort.html" class="sidebar-link">高级排序算法</a></li><li><a href="/blog/base-design-pattern.html" class="sidebar-link">设计模式</a></li><li><a href="/blog/base-computer.html" class="sidebar-link">计算机组成原理</a></li><li><a href="/blog/base-technology.html" class="sidebar-link">专业术语</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>总结思考</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/2020-6.html" class="sidebar-link">我的 2020 总结（上）</a></li><li><a href="/blog/2019-12.html" class="sidebar-link">我的 2019 总结（下）</a></li><li><a href="/blog/2019-6.html" class="sidebar-link">我的 2019 总结（上）</a></li><li><a href="/blog/2018.html" class="sidebar-link">我的 2018 总结</a></li><li><a href="/blog/frontend.html" class="sidebar-link">我的前端知识清单</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/other-pit.html" class="sidebar-link">记录遇到的坑</a></li><li><a href="/blog/other-tools.html" class="sidebar-link">常用工具整理</a></li><li><a href="/blog/other-vscode.html" class="sidebar-link">VSCode 常用快捷键</a></li><li><a href="/blog/other-npm.html" class="sidebar-link">实用的 npm 包</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实战-手搭一个-react-typescript-koa-graphql-环境"><a href="#实战-手搭一个-react-typescript-koa-graphql-环境" class="header-anchor">#</a> 实战：手搭一个 React，Typescript，Koa，GraphQL 环境</h1> <blockquote><p>本文系原创，转载请附带作者信息：mengsixing</p> <p>项目地址：<a href="https://github.com/mengsixing/cdfang-spider" target="_blank" rel="noopener noreferrer">https://github.com/mengsixing/cdfang-spider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>在实际的开发过程中，从零开始初始化一个项目往往很麻烦，所以各种各样的脚手架工具应运而生。crea-react-app，vue-cli，@angular/cli 等脚手架工具，只需要执行一个命令，项目结构以及开发环境就搭建好了。</p> <p>脚手架工具确实方便了我们使用，开发者可以专注于业务，而不需要考虑太多的环境搭建。但作者认为，学习脚手架工具背后的搭建过程也是很重要的，以防脚手架挂了之后，我们还能正常搭建项目。基于这个目的，作者从零搭建了<a href="https://github.com/mengsixing/cdfang-spider" target="_blank" rel="noopener noreferrer">cdfang-spider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>项目。</p> <p>现在让我们就以这个项目为例，从零开始搭建项目吧。</p> <h2 id="项目选型"><a href="#项目选型" class="header-anchor">#</a> 项目选型</h2> <ol><li><p>三大框架里选哪个？</p> <ul><li>react 个人爱好。</li> <li>react-router 定义路由。</li> <li>react context 状态管理。</li> <li>react hooks 组件化。</li></ul></li> <li><p>引入强类型语言？</p> <ul><li>typescript。为 js 提供类型支持，编辑器友好，增加代码可维护性，使用起来心里踏实。</li> <li>在使用第三方库时，可以写出更加符合规范的代码，避免 api 乱用等。</li> <li>项目中依赖了大量 @types/xxx 包，无形中增加了项目体积。</li> <li>编辑器对 ts 文件进行类型检查，需要遍历 node_modules 目录下所有的 @types 文件，会造成编辑器卡顿现象。</li> <li>目前仍然存在很多库没有 @types 支持，使用起来并不方便。</li></ul></li> <li><p>css 选型？</p> <ul><li>预编译器 less。项目中使用了变量定义，选择器嵌套，选择器复用等，less 够用了。</li> <li>解决命名冲突可以使用 css modules，暂未考虑 css in js。</li> <li>使用 bem 命名规范。</li> <li>使用 postcss 插件 autoprefixer，增加 css 兼容性。</li></ul></li> <li><p>构建工具选哪个？</p> <ul><li>webpack。内置 tree shaking，scope hosting 等，打包效率高，社区活跃。</li> <li>webpack-merge 合并不同环境配置文件。</li> <li>配置 externals。引入 cdn 代替 node_modules 中体积较大的包。</li> <li>gulp。用来打包 node 端代码。</li></ul></li> <li><p>代码规范检查？</p> <ul><li>eslint。辅助编码规范执行，有效控制代码质量。同时也支持校验 typescript 语法。</li> <li>配置 eslint-config-airbnb 规则。</li> <li>配置 eslint-config-prettier 关闭和 prettier 冲突的规则。</li></ul></li> <li><p>测试框架选型？</p> <ul><li>jest。大而全，包含：测试框架，断言库，mock 数据，覆盖率等。</li> <li>enzyme。测试 react 组件。</li></ul></li> <li><p>后端框架选型？</p> <ul><li>koa。精简好用，中间件机制强大。</li> <li>apollo-server。帮助搭建 graphQL 后端环境。</li></ul></li> <li><p>数据库选型？</p> <ul><li>mongodb。类 json 的存错格式，方便存储，前端友好。</li> <li>配置 mongoose，方便给 mongodb 数据库建模。</li></ul></li> <li><p>接口方式选型？</p> <ul><li>graphql。可以根据需要格式获取对应数据，减少接口冗余数据。</li> <li>graphql schema 定义了后端接口的参数，操作和返回类型，从此不需要提供接口文档。</li> <li>前端可以在 schema 定义后开始开发，数据格式自己掌握。</li> <li>schema 可拼接。可以组合和连接多个 graphql api，进行级联查询等。</li> <li>社区友好，有很多优秀的库可以直接使用： apollo，relay 等。</li></ul></li></ol> <p>基本框架选型完毕，接下来就开始搭建项目环境。</p> <h2 id="搭建-typescript-环境"><a href="#搭建-typescript-环境" class="header-anchor">#</a> 搭建 TypeScript 环境</h2> <p>TypeScript 是 JavaScript 的超集，意味着可以完全兼容 JavaScript 文件，但 TypeScript 文件却并不能直接在浏览器中运行，需要经过编译生成 JavaScript 文件后才能运行。</p> <p>1、 新建 tsconfig.json 文件。</p> <ul><li>tsc -init 生成初始化 tsconfig.json 文件。</li> <li>vscode 会根据 tsconfig.json 文件，进行动态类型检查，语法错误提示等。</li> <li>tsc 命令会根据 tsconfig.json 文件配置的规则，将 ts 代码转换为 js 代码。</li> <li>tslint 会读取 tsconfig.json 文件中的规则，辅助编码规范校验。
<ul><li>tslint 官宣会被废弃，后将被 eslint 代替。</li> <li>eslint 同样会用到 tsconfig.json 文件中的内容。</li></ul></li></ul> <p>2、 配置 eslint。</p> <p>根据 <a href="https://github.com/typescript-eslint/typescript-eslint" target="_blank" rel="noopener noreferrer">typescript-eslint<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 引导，配置 eslint 对 typescript 的支持。</p> <ul><li>@typescript-eslint/parser 解析 ts 语法。</li> <li>@typescript-eslint/eslint-plugin 为 ts 文件应用 eslint 和 tslint 规则。</li></ul> <p>3、 选择一个 typescript 编译器，tsc 还是 babel？</p> <p>使用 babel。好处如下：</p> <ul><li>babel 社区有许多非常好的插件，babel-preset-env 可以支持到具体兼容浏览器的版本号，而 tsc 编译器没这个功能。</li> <li>babel 可以同时支持编译 js 和 ts，所以没必要在引入 tsc 编译 ts 文件，只管理一个编译器，可维护性更高。</li> <li>babel 编译速度更快。tsc 编译器需要遍历所有类型定义文件（*.d.ts），包括 node_modules 里的，以确保代码中正确地使用，type 太多会造成卡顿。</li></ul> <blockquote><p><strong>babel 流程分析</strong></p> <p>babel 是一个 js 语法编译器，在编译时分为 3 个阶段：解析、转换、输出。</p> <ul><li>解析阶段：将 js 代码解析为抽象语法树（ast）。</li> <li>转换阶段：对 ast 进行修改，产生一个转换后的 ast。</li> <li>输出阶段：将转换后的 ast 输出成 js 文件。</li></ul> <p><strong>plugin 和 preset</strong></p> <ul><li>plugin: 解析，转换，并输出转换后的 js 文件。例如：@babel/plugin-proposal-object-rest-spread 会输出支持<code>{...}</code>解构语法的 js 文件。</li> <li>preset: 是一组组合好的 plugin 集合。例如：@babel/preset-env 让代码支持最新的 es 语法，自动引入需要支持新特性的 plugin。</li></ul></blockquote> <p>4、搜集所有的 ts，tsx 页面（前端环境使用 webpack，node 项目使用 gulp），然后通过 babel 编译成 js 文件。</p> <h2 id="搭建-react-环境"><a href="#搭建-react-环境" class="header-anchor">#</a> 搭建 React 环境</h2> <p>React 是一个库，基于组件式开发，开发时常常需要用到以下语法：</p> <ul><li>es6 模块化。</li> <li>jsx 语法。</li> <li>typescript 语法。</li> <li>css 预处理器。</li></ul> <p>这些语法在目前浏览器中并不能直接执行，需要进行打包编译，这也是搭建 React 环境的主要工作。</p> <h3 id="具体步骤"><a href="#具体步骤" class="header-anchor">#</a> 具体步骤</h3> <p>1、新建一个 html 文件，并在 body 中创建一个根节点，用于挂载 react 最后生成的 dom。</p> <p>2、新建一个 index.tsx 文件，用于将项目中的所有组件，引入进来，并调用 render 方法，将组件渲染到根节点中。</p> <p>3、React 项目分层。</p> <ul><li>containers 目录，存放单独的页面</li> <li>components 目录，存放的是组件，一个组件包含 jsx 和 css 两个部分。</li> <li>context 目录，存放公用的 react context。</li> <li>config 目录，存放公共配置文件。</li> <li>utils 目录，公用的函数组件库。</li> <li>constants 目录，存放静态变量。</li></ul> <p>4、配置 webpack，以 index.tsx 为入口文件，进行打包编译。</p> <ul><li>由于不同环境的打包方式并不相同，这里抽象出开发环境、上线环境、优化环境的配置文件，使用 webpack-merge 合并配置文件。</li> <li>配置 css 预处理器，使用 less-loader。</li> <li>配置 ts 编译器，使用 babel-loader。
<ul><li>@babel/preset-env：编译最新的 es 语法。</li> <li>@babel/preset-react：编译 react 语法。</li> <li>@babel/preset-typescript：转换 typescript 语法。</li></ul></li> <li>配置 url-loader，打包项目中的图片资源。</li> <li>配置 html-webpack-plugin 将最后生成的 js，css，注入第 1 步的 html 中。
<ul><li>使用 ejs 模板配置开发环境和线上环境引入的 cdn。</li></ul></li> <li>开发环境配置，使用开箱即用的 webpack-dev-server。
<ul><li>webpack-dev-server 可以自动监听文件修改，自动刷新页面，以及默认 source-map 等功能。</li> <li>配置热模块替换，react-hot-loader。</li></ul></li></ul> <blockquote><p>webpack 打包原理</p> <p>webpack 打包过程就像是一条流水线，从入口文件开始，搜集项目中所有文件的依赖关系，如果遇到不能够识别的模块，就使用对应的 loader 转换成能够识别的模块。webpack 还能使用 plugin 在流水线生命周期中挂载自定义事件，来控制 webpack 输出结果。</p></blockquote> <p>5、编写 npm script，一键开启开发模式。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// cross-env 用来跨环境设置环境变量</span>
<span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;dev:client&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development webpack-dev-server --open&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>6、现在运行 <code>npm run dev:client</code> 就可以愉快地编写客户端代码了。</p> <h2 id="搭建-nodejs-环境"><a href="#搭建-nodejs-环境" class="header-anchor">#</a> 搭建 NodeJs 环境</h2> <p>由于 node 端使用了 typescript 和最新的 es 语法，所以需要进行打包编译。</p> <ul><li>配置 gulp，遍历每一个 ts 文件，调用 gulp-babel，将 ts 代码转换成 js 代码。</li> <li>配置 supervisor 自动重启 node 服务（nodemon 对于不存在的目录不能进行监控）。</li> <li>编写 npm script 一键启动 node 端开发环境。</li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;dev:server&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=development gulp &amp; cross-env NODE_ENV=development supervisor -i ./dist/client/ -w ./dist/ ./dist/app.js&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>配置好 gulp 后，就可以运行 <code>npm run dev:server</code> 一键启动服务器端开发环境。</p> <h3 id="层次结构划分"><a href="#层次结构划分" class="header-anchor">#</a> 层次结构划分</h3> <p>项目采用传统的 mvc 模式进行层次划分。</p> <h4 id="model-层"><a href="#model-层" class="header-anchor">#</a> Model 层</h4> <p>Model 层的主要工作：连接数据库，封装数据库操作，例如：新增数据、删除数据、查询数据、更新数据等。</p> <ul><li>新建 model 文件夹，目录下的每一个文件对应数据库的一个表。</li> <li>model 文件中包含对一个数据表的增删改查操作。
<ul><li>使用 mongoose 更方便地对 mongodb 数据库进行读写操作。</li></ul></li> <li>model 文件返回封装好的对象，提供给 controller 层使用。</li></ul> <h4 id="controller-层"><a href="#controller-层" class="header-anchor">#</a> Controller 层</h4> <p>Controller 层的主要工作：接收和发送 http 请求。根据前端请求，调用 model 层获取数据，再返回给前端。</p> <blockquote><p>传统的后端一般还包含 service 层，专门用来处理业务逻辑。</p></blockquote> <ul><li>根据前端请求，找到对应的 model 层获取数据，经过加工处理后，返回给前端。</li> <li>编写中间件，记录系统日志，错误处理，404 页面等。</li> <li>支持前端 react-router 中的 BrowserRouter。根据前端路由，后端配置对应的路由，匹配结果为 index.html 文件。</li> <li>项目中使用的 graphql 比较基础，也直接放在了 controller 层进行处理。</li></ul> <h4 id="view-层"><a href="#view-层" class="header-anchor">#</a> View 层</h4> <p>View 层的主要工作：提供前端页面模板。如果是服务器端渲染，是将 model 层的数据注入到 view 层中，最后通过 controller 层返回给客户端。由于本项目前端使用 react 渲染，所以 view 层直接是经过 webpack 打包后的页面。</p> <ul><li>使用 koa-static 提供一个静态文件服务器，用来访问前端打包后生成的 html 文件。</li></ul> <h3 id="搭建-graphql-环境"><a href="#搭建-graphql-环境" class="header-anchor">#</a> 搭建 GraphQL 环境</h3> <p>GraphQL 是一种用于 api 的查询语言，需要服务器端配置 graphql 支持，同时也需要客户端使用 graphql 语法的格式进行请求。</p> <p>使用 apollo 更快的搭建 graphql 环境。</p> <ul><li>服务器端配置 apollo-server。
<ul><li>使用 schema，定义请求的类型，返回的格式。</li> <li>使用 resolvers 来处理对应的 schema。</li></ul></li> <li>客户端配置 apollo-client。
<ul><li>按照 apollo-server 定义的 schema，来请求数据。</li></ul></li></ul> <h3 id="搭建-mongodb-环境"><a href="#搭建-mongodb-环境" class="header-anchor">#</a> 搭建 MongoDB 环境</h3> <p>MongoDB 是一个面向文档存储的数据库，操作起来十分简单。</p> <p>Mongoose 为 mongodb 提供了一种直接的，基于 scheme 结构去定义你的数据模型。它内置数据验证，查询构建，业务逻辑钩子等，开箱即用。</p> <ul><li>使用 mongoose 建立和本地 mongodb 的连接。</li> <li>创建 model 模型，一个模型对应 mongodb 里的一张表。</li> <li>根据 model 封装增删改查功能，并返回给 controller 层使用。</li></ul> <p>接下来的步骤就是安装 mongodb，启动服务，就可以了。</p> <h2 id="搭建测试环境"><a href="#搭建测试环境" class="header-anchor">#</a> 搭建测试环境</h2> <p>本项目使用 jest 作为测试框架，jest 包含了断言库、测试框架、mock 数据等功能，是一个大而全的测试库。由于前端使用了 react 项目，这里引入了专门用来测试 react 的 enzyme 库。</p> <p>1、新建 jest.config.js 文件。</p> <ul><li>配置初始化 setup.ts 文件。
<ul><li>根据 react 版本配置对应的 enzyme-adapter。</li> <li>mock 全局变量，如 fech，canvas 等。</li></ul></li> <li>配置需要测试的文件。</li> <li>配置 mock 数据文件。</li> <li>配置测试文件的编译方式。
<ul><li>ts 代码使用 ts-jest 编译。</li></ul></li> <li>配置代码覆盖率文件。</li></ul> <p>2、编写测试文件。</p> <ul><li>新建__mocks__，__tests__目录，存放测试文件和 mock 数据文件。</li> <li>按照 src 中的目录，建立相应的测试文件目录。</li></ul> <p>3、编写测试脚本和上传覆盖率脚本。</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --no-cache --colors --coverage --forceExit --detectOpenHandles&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;coverage&quot;</span><span class="token operator">:</span> <span class="token string">&quot;codecov&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="配置上线环境"><a href="#配置上线环境" class="header-anchor">#</a> 配置上线环境</h2> <p>安装好各种环境之后，接下来就要考虑项目上线了。</p> <h3 id="配置服务器环境"><a href="#配置服务器环境" class="header-anchor">#</a> 配置服务器环境</h3> <ul><li>安装 nodejs 环境。<a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noopener noreferrer">nvm 安装 node<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>安装 pm2 进程守护。<code>npm i pm2 -g</code></li> <li>安装 mongodb。<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/" target="_blank" rel="noopener noreferrer">mongodb 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>安装免费 https 证书。<a href="https://letsencrypt.org/" target="_blank" rel="noopener noreferrer">letsencrypt 官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>域名需要先进行备案（使用阿里云备案，资料准备齐全的话 10 天左右就可以批下来）。</li></ul></li></ul> <h3 id="代码发布"><a href="#代码发布" class="header-anchor">#</a> 代码发布</h3> <p>本项目发布非常简单，只需要一步操作就搞定了，这些都是经过持续集成配置后的结果。</p> <div class="language-zsh line-numbers-mode"><pre class="language-text"><code># clone with Git Bash
git clone https://github.com/mengsixing/cdfang-spider.git

# change directory
cd cdfang-spider

# install dependencies
npm i

# build for production with minification
npm run build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>所有的事情都在 build 命令下完成了，我们分析一下 npm run build 命令做的事情。</p> <ul><li>eslint 语法错误检查。</li> <li>单元测试。
<ul><li>上传测试覆盖率。</li></ul></li> <li>打包客户端代码。
<ul><li>打包后生成 html 文件作为 node 端的 view 层，和后端绑定在一起。</li> <li>其他静态资源，在 webpack 打包后自动上传到七牛 cdn，使用 <a href="https://www.npmjs.com/package/qiniu-upload-plugin" target="_blank" rel="noopener noreferrer">qiniu-upload-plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来进行一键上传。</li></ul></li> <li>打包服务器端代码。</li></ul> <p>上述事情通过创建 npm script 就可以了完成需求了，但这些命令也不应该每次都由手工敲一遍，通过配置 travisCI，每一次 master 分支提交代码时，自动运行上述命令就行了。</p> <h4 id="travisci-配置"><a href="#travisci-配置" class="header-anchor">#</a> travisCI 配置</h4> <p>travisCI 是一个持续集成平台，每当 github 提交代码时，travisCI 就会得到通知，然后根据 travisCI 中的配置信息执行相应的操作，并及时把运行结果反馈给用户。travisCI 配置文件可以参考项目根目录下的 <code>.travis.yml</code> 文件。配置文件核心在于 script 的配置。</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">script</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> npm run build
  <span class="token punctuation">-</span> npm run test
<span class="token key atrule">after_success</span><span class="token punctuation">:</span> npm run coverage
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以看到，每一次 github 提交后，travisCI 就会执行 名称为 build 的任务，任务分为 2 个步骤，首先执行 build 命令，然后执行 test 命令，当命令都执行完成后，执行 coverage 命令。如果执行命令期间出现任何错误，travisCI 会通过邮件及时通知我们。真正要上线时，先查看 ci 状态，如果已通过所有的步骤，那就不用担心发布的代码有问题了。</p> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>至此，整个项目选型与搭建流程已经介绍完毕了，当然还有一些很细节的地方没有写进去，如果有不太明白的地方，可以提 issue，或者加我微信 yhl2016226。</p> <p>接下来对以下 4 个方面写个小总结。</p> <ul><li>开发方面：项目将前端、后端、数据库端连通起来，组合成了一个小全栈的项目，加深了我对整个开发环节的理解。</li> <li>测试方面：通过编写单元测试，ui 测试，api 测试，积累了自动化测试方面的经验。</li> <li>运维方面：通过配置持续集成，守护进程，nginx，https 等，让我有能力实现小型项目的部署。</li> <li>技术方面：项目中使用了一些比较新的技术，如：hooks api，graphql 等，但用的都很基础，主要是为了练手，后续还得深入学习。</li></ul> <p>对于项目后期更新，主要是基于以下几个方面：graphql，docker，k8s，微服务，serverless 等，东西太多，还得加油学习啊，😂</p> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://juejin.im/post/5c822e426fb9a04a0a5ffb49" target="_blank" rel="noopener noreferrer">TypeScript 和 Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/sorrycc/f2e-decision-tree" target="_blank" rel="noopener noreferrer">前端决策树<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/mengsixing/blog/edit/master/docs/blog/devops-cdfang-spider.md" target="_blank" rel="noopener noreferrer">本文源码地址</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">1/6/2021, 6:31:21 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/devops-webpack.html" class="prev">
        Webpack 系列（一）使用总结
      </a></span> <span class="next"><a href="/blog/library-node.html">
        Node.js 使用总结
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.743a7fff.js" defer></script><script src="/assets/js/2.807b3b4f.js" defer></script><script src="/assets/js/38.7fd498f0.js" defer></script><script src="/assets/js/3.f6a35f03.js" defer></script>
  </body>
</html>
